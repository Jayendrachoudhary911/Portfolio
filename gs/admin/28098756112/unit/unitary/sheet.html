<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Entry Web App</title>
    <link rel="icon" type="image/png" href="https://wiyou.vercel.app/assets/logo.png">
    <style>
        /* Same styles as before */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffffff;
        }
        .container {
            max-width: 500px;
            width: 100%;
            padding: 20px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .button {
            width: 100%;
            background-color: #020202;
            color: white;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease-in-out;
        }
        .button:hover {
            background-color: #ffffff;
            color: #020202;
            border: 1px solid #020202;
        }
        .loading, .popup {
            display: none;
            padding: 10px;
            margin-top: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .loading {
            background-color: #e6e6e6;
            color: #1a1a1a;
            font-weight: bold;
        }
        .popup {
            background-color: #dff0d8;
            color: #3c763d;
            font-weight: bold;
        }

        /* Responsive Styles */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            input, select {
                padding: 8px;
            }
            .button {
                font-size: 14px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Data Entry Form</h2>
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Enter your name" required>
        </div>
        <div class="form-group">
            <label for="pin">Unique 6-Digit Pin</label>
            <input type="text" id="pin" maxlength="6" placeholder="Enter pin" required>
        </div>
        <div class="form-group">
            <label for="resources">Resources</label>
            <select id="resources" disabled>
                <option value="">Select a resource</option>
            </select>
        </div>
        <div class="form-group">
            <label for="progress">Progress (%)</label>
            <input type="number" id="progress" min="0" max="100" placeholder="Enter progress in %" required>
        </div>
        <button class="button" onclick="submitData()">Submit</button>
        <div class="loading">Sending data, please wait...</div>
        <div class="popup">
            <div>Data submitted successfully!</div>
            <button onclick="clearForm()">Close</button>
        </div>
    </div>

    <script>
        // Predefined pins and their corresponding resources
        const pinResourceMapping = {
            "123456": ["HTML Basics", "CSS Basics", "JavaScript Introduction"],
            "234567": ["Python Basics", "Data Structures", "Machine Learning"],
            "345678": ["React", "Node.js", "Express"],
            "456789": ["AWS Basics", "Google Cloud", "Azure"]
        };

        // Update Resources dropdown based on Pin
        document.getElementById('pin').addEventListener('input', function () {
            const pin = this.value;
            const resourcesDropdown = document.getElementById('resources');

            // Clear existing options
            resourcesDropdown.innerHTML = '<option value="">Select a resource</option>';
            resourcesDropdown.disabled = true;

            // Check if the pin exists in the mapping
            if (pinResourceMapping[pin]) {
                const resources = pinResourceMapping[pin];
                resources.forEach(resource => {
                    const option = document.createElement('option');
                    option.value = resource;
                    option.textContent = resource;
                    resourcesDropdown.appendChild(option);
                });
                resourcesDropdown.disabled = false;
            }
        });

        // Simple encryption function
        function encryptData(data) {
            const encryptedData = btoa(data); // Base64 encoding (simple encryption)
            return encryptedData;
        }

        // Submit data to Google Sheets
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyekiTYyOxcm3wVHK2DSDaP_9E8EXi9WrH50xM_3GF3qsfz3mcfyAabDocWdDzN3oV81Q/exec';

        function submitData() {
            const name = document.getElementById('name').value;
            const pin = document.getElementById('pin').value;
            const resource = document.getElementById('resources').value;
            const progress = document.getElementById('progress').value;

            if (!name || !pin || !resource || !progress) {
                alert("Please fill out all fields!");
                return;
            }

            const encryptedPin = encryptData(pin);
            const encryptedResource = encryptData(resource);

            const data = {
                name: name,
                pin: encryptedPin,
                resource: encryptedResource,
                progress: progress,
                dateTime: new Date().toLocaleString()
            };

            document.querySelector('.loading').style.display = 'block';
            document.querySelector('.popup').style.display = 'none';

            fetch(scriptURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.result === 'success') {
                    document.querySelector('.popup').style.display = 'block';
                }
                document.querySelector('.loading').style.display = 'none';
            })
            .catch(error => {
                console.error('Error!', error.message);
                document.querySelector('.loading').style.display = 'none';
            });
        }

        // Clear form fields and close the popup
        function clearForm() {
            document.getElementById('name').value = '';
            document.getElementById('pin').value = '';
            document.getElementById('resources').innerHTML = '<option value="">Select a resource</option>';
            document.getElementById('resources').disabled = true;
            document.getElementById('progress').value = '';
            document.querySelector('.popup').style.display = 'none';
        }
    </script>
</body>
</html>
